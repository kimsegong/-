<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/locales-all.js"></script>
<head th:replace="~{layout/header::head('Daily_Plan')}"></head>
<style>
   /* FullCalendar 화살표 색상 변경 */
   .fc .fc-button {
      color: white; /* 텍스트 색상을 흰색으로 변경 */
      background-color: #EAD8C0; /* 배경 색상을 파란색으로 변경 */
      border-color: #EAD8C0; /* 테두리 색상도 파란색으로 변경 */
   }

   .fc .fc-button-primary:not(:disabled).fc-button-active, .fc .fc-button-primary:disabled {
      background-color: #A79277; /* 활성화된 버튼의 배경 색상 설정 */
      border-color: #A79277; /* 활성화된 버튼의 테두리 색상 설정 */
   }

   .fc .fc-button-primary:hover {
      background-color: #795458; /* 호버 시 버튼의 배경 색상 설정 */
      border-color: #795458; /* 호버 시 버튼의 테두리 색상 설정 */
   }

</style>
<body>

   <div th:replace="~{layout/header::header}"></div>

   <div class="container">
      <div class="row">
         <div class="col-md-3">
            <ul class="nav flex-column">
               <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="#">달력</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="/">ToDoList</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="#">설정</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link disabled" aria-disabled="true">행복한하루되세연</a>
               </li>
            </ul>
         </div>
         <div class="col-md-9">
            <div id='calendar'></div>
         </div>
      </div>
   </div>
   <!-- 새글모달 -->
   <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
         <div class="modal-content">
            <div class="modal-header">
               <h5 class="modal-title" id="eventModalLabel">이벤트 추가</h5>
               <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
               <form method="post" id="eventForm" th:action="@{/layout/add.do}">
                  <div class="form-group">
                     <label for="firstPlan">첫번째일정</label>
                     <input type="text" class="form-control" name="firstPlan" id="firstPlan">
                  </div>
                  <div class="form-group">
                     <label for="firstComment">내용</label>
                     <input type="text" class="form-control" name="firstComment" id="firstComment">
                  </div>
                  <div class="form-group">
                     <label for="secondPlan">두번째일정</label>
                     <input type="text" class="form-control" name="secondPlan" id="secondPlan">
                  </div>
                  <div class="form-group">
                     <label for="secondComment">내용</label>
                     <input type="text" class="form-control" name="secondComment" id="secondComment">
                  </div>
                  <div class="form-group">
                     <label for="thirdPlan">세번째일정</label>
                     <input type="text" class="form-control" name="thirdPlan" id="thirdPlan">
                  </div>
                  <div class="form-group">
                     <label for="thirdComment">내용</label>
                     <input type="text" class="form-control" name="thirdComment" id="thirdComment">
                  </div>
                  <div class="form-group">
                     <label for="startAt">시작 날짜</label>
                     <input type="datetime-local" name="startAt" class="form-control" id="startAt">
                  </div>
                  <div>
                     <label for="endAt" class="form-label">끝날짜/시간</label>
                     <input type="datetime-local" name="endAt" id="endAt" class="form-control">
                  </div>
                  <!-- 여기에 필요한 다른 입력 필드 추가 -->
                  <div class="d-grid gap-2 col-6 mx-auto">
<!--                     <input type="hidden" name="userNo" th:value="${session.user.userNo}">-->
                     <button type="submit" class="btn btn-primary" style="margin: 32px;">작성완료</button>
                  </div>
               </form>
            </div>
         </div>
      </div>
   </div>

   <!-- 수정모달 -->
   <div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventModalLabel" aria-hidden="true">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
               <h5 class="modal-title" id="editEventModalLabel">일정 수정</h5>
               <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
               <form id="editEventForm">
                  <div class="form-group">
                     <label for="editEventTitle">제목</label>
                     <input type="text" class="form-control" id="editEventTitle">
                  </div>
                  <div class="form-group">
                     <label for="editEventStart">시작 시간</label>
                     <input type="datetime-local" class="form-control" id="editEventStart">
                  </div>
                  <div class="form-group">
                     <label for="editEventEnd">종료 시간</label>
                     <input type="datetime-local" class="form-control" id="editEventEnd">
                  </div>
                  <!-- 추가 필드 구성 가능 -->
               </form>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-primary" onclick="updateEvent()">저장</button>
            </div>
         </div>
      </div>
   </div>




   <script th:inline="javascript">
      document.addEventListener('DOMContentLoaded', function() {
         var calendarEl = document.getElementById('calendar');
         var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
               left: 'prev,next today',
               center: 'title',
               right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            locale: 'ko',
            events: function(fetchInfo, successCallback, failureCallback) {
               fetch('/layout/plan.do')
                       .then(response => response.json())
                       .then(data => {
                          var events = data.map(plan => ({
                             title: [plan.firstPlan, plan.secondPlan, plan.thirdPlan].filter(Boolean), // 이벤트 제목에 줄바꿈 포함
                             start: plan.startAt,
                             end: plan.endAt,
                             extendedProps: {
                                details: [plan.firstComment, plan.secondComment, plan.thirdComment].filter(Boolean), // 추가 세부 정보가 있다고 가정
                             }
                          }));
                          successCallback(events);
                       })
                       .catch(error => {
                          console.error('Error fetching events:', error);
                          failureCallback(error);
                       });
            },
                        eventClick: function(info) {
                           var event = info.event;
                           var modal = $('#editEventModal');
                           var details = event.extendedProps.details.join("<br>"); // 세부사항을 줄바꿈으로 구분하여 표시
                           modal.find('#eventDetails').html(details); // 모달 내부의 세부사항 위치에 텍스트 설정
                           modal.modal('show'); // 모달 표시
                        },
                    eventMouseEnter: function(info) {
                       // 마우스 오버 시 툴팁으로 간단한 정보 표시
                       var details = info.event.extendedProps.details || '없음'; // details가 undefined일 경우 대체 텍스트
                       $(info.el).tooltip({
                          title: `${info.event.title}<br>${details}`, // HTML로 렌더링
                          html: true,
                          placement: 'top',
                          trigger: 'hover'
                       }).tooltip('show');
                 },
            editable: true,
            selectable: true,
            droppable: true,
            dateClick: function(info) {
               $('#eventStart').val(info.dateStr); // 날짜 필드를 클릭된 날짜로 설정
               $('#eventModal').modal('show'); // 모달 창 보이기
            }
         });

         calendar.render();
         // 모달에서 폼 제출 처리
         $('#eventForm').on('submit', function(e) {
            e.preventDefault();

            var eventData = {
               firstPlan: $('#firstPlan').val(),
               firstContent: $('#firstComment').val(),  // 내용 필드 id가 firstComment로 가정
               secondPlan: $('#secondPlan').val(),
               secondContent: $('#secondComment').val(),
               thirdPlan: $('#thirdPlan').val(),
               thirdContent: $('#thirdComment').val(),
               start: $('#startAt').val(),
               end: $('#endAt').val()
            };

            // AJAX 요청을 통해 서버로 데이터 전송
            $.ajax({
               url: '/layout/add.do',  // 서버의 API 경로
               type: 'POST',
               contentType: 'application/json',
               data: JSON.stringify(eventData),
               success: function(response) {
                  alert('이벤트가 성공적으로 추가되었습니다.');
                  // 필요한 경우 페이지 새로 고침 등의 추가 작업 수행
               },
               error: function(xhr, status, error) {
                  alert('이벤트 추가 실패: ' + xhr.responseText);
               }
            });
         });
      });


   </script>






   <div th:replace="~{layout/footer::footer}"></div>
</body>
</html>
